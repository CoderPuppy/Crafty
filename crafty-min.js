(function(window,undefined){var Crafty=function(selector){return new Crafty.fn.init(selector)},GUID=1,FPS=50,frame=1,components={},entities={},handlers={},onloads=[],tick,tickID,noSetter,loops=0,skipTicks=1000/FPS,nextGameTick=(new Date).getTime(),slice=Array.prototype.slice,rlist=/\s*,\s*/,rspace=/\s+/;Crafty.fn=Crafty.prototype={init:function(selector){if(typeof selector==="string"){var elem=0,e,current,and=false,or=false,del,comps,score,i,l;if(selector==='*'){for(e in entities){this[+e]=entities[e];elem++}this.length=elem;return this}if(selector.indexOf(',')!==-1){or=true;del=rlist}else if(selector.indexOf(' ')!==-1){and=true;del=rspace}for(e in entities){if(!entities.hasOwnProperty(e))continue;current=entities[e];if(and||or){comps=selector.split(del);i=0;l=comps.length;score=0;for(;i<l;i++)if(current.__c[comps[i]])score++;if(and&&score===l||or&&score>0)this[elem++]=+e}else if(current.__c[selector])this[elem++]=+e}if(elem>0&&!and&&!or)this.extend(components[selector]);if(comps&&and)for(i=0;i<l;i++)this.extend(components[comps[i]]);this.length=elem}else{if(!selector){selector=0;if(!(selector in entities))entities[selector]=this}if(!(selector in entities)){this.length=0;return this}this[0]=selector;this.length=1;if(!this.__c)this.__c={};if(!entities[selector])entities[selector]=this;return entities[selector]}return this},addComponent:function(id){var uninit=[],c=0,ul,i=0,l,comps;if(arguments.length>1){l=arguments.length;for(;i<l;i++){this.__c[arguments[i]]=true;uninit.push(arguments[i])}}else if(id.indexOf(',')!==-1){comps=id.split(rlist);l=comps.length;for(;i<l;i++){this.__c[comps[i]]=true;uninit.push(comps[i])}}else{this.__c[id]=true;uninit.push(id)}ul=uninit.length;for(;c<ul;c++){comp=components[uninit[c]];this.extend(comp);if(comp&&"init"in comp){comp.init.call(this)}}this.trigger("NewComponent",ul);return this},requires:function(list){var comps=list.split(rlist),i=0,l=comps.length,comp;for(;i<l;++i){comp=comps[i];if(!this.has(comp))this.addComponent(comp)}return this},removeComponent:function(id,soft){if(soft===false){var props=components[id],prop;for(prop in props){delete this[prop]}}delete this.__c[id];this.trigger("RemoveComponent",id);return this},has:function(id){return!!this.__c[id]},attr:function(key,value){if(arguments.length===1){if(typeof key==="string"){return this[key]}this.extend(key);this.trigger("Change");return this}this[key]=value;this.trigger("Change");return this},toArray:function(){return slice.call(this,0)},delay:function(fn,duration){this.each(function(){var self=this;setTimeout(function(){fn.call(self)},duration)});return this},bind:function(event,fn){if(this.length===1){if(!handlers[event])handlers[event]={};var h=handlers[event];if(!h[this[0]])h[this[0]]=[];h[this[0]].push(fn);return this}this.each(function(){if(!handlers[event])handlers[event]={};var h=handlers[event];if(!h[this[0]])h[this[0]]=[];h[this[0]].push(fn)});return this},unbind:function(event,fn){this.each(function(){var hdl=handlers[event],i=0,l,current;if(hdl&&hdl[this[0]])l=hdl[this[0]].length;else return this;if(!fn){delete hdl[this[0]];return this}for(;i<l;i++){current=hdl[this[0]];if(current[i]==fn){current.splice(i,1);i--}}});return this},trigger:function(event,data){if(this.length===1){if(handlers[event]&&handlers[event][this[0]]){var fns=handlers[event][this[0]],i=0,l=fns.length;for(;i<l;i++){fns[i].call(this,data)}}return this}this.each(function(){if(handlers[event]&&handlers[event][this[0]]){var fns=handlers[event][this[0]],i=0,l=fns.length;for(;i<l;i++){fns[i].call(this,data)}}});return this},each:function(fn){var i=0,l=this.length;for(;i<l;i++){if(!entities[this[i]])continue;fn.call(entities[this[i]],i)}return this},clone:function(){var comps=this.__c,comp,prop,clone=Crafty.e();for(comp in comps){clone.addComponent(comp)}for(prop in this){clone[prop]=this[prop]}return clone},setter:function(prop,fn){if(Crafty.support.setter){this.__defineSetter__(prop,fn)}else if(Crafty.support.defineProperty){Object.defineProperty(this,prop,{set:fn,configurable:true})}else{noSetter.push({prop:prop,obj:this,fn:fn})}return this},destroy:function(){this.each(function(){this.trigger("Remove");for(var e in handlers){this.unbind(e)}delete entities[this[0]]})}};Crafty.fn.init.prototype=Crafty.fn;Crafty.extend=Crafty.fn.extend=function(obj){var target=this,key;if(!obj)return target;for(key in obj){if(target===obj[key])continue;target[key]=obj[key]}return target};Crafty.extend({init:function(w,h){Crafty.viewport.init(w,h);this.trigger("Load");this.timer.init();return this},stop:function(){Crafty('*').each(function(e){e.destroy()});entities={};handlers={};GUID=0;this.timer.stop();this.trigger("Stop");Crafty.stage.elem.parentNode.removeChild(Crafty.stage.elem);return this},pause:function(){if(!this._paused){this.trigger('Pause');this._paused=true;Crafty.timer.stop();Crafty.keydown={}}else{this.trigger('Unpause');this._paused=false;Crafty.timer.init()}return this},timer:{prev:(+new Date),current:(+new Date),fps:0,init:function(){var onFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null;if(onFrame){tick=function(){Crafty.timer.step();tickID=onFrame(tick)}tick()}else{tick=setInterval(Crafty.timer.step,1000/FPS)}},stop:function(){Crafty.trigger("CraftyStop");if(typeof tick==="number")clearInterval(tick);var onFrame=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null;if(onFrame)onFrame(tickID);tick=null},step:function(){loops=0;while((new Date).getTime()>nextGameTick){Crafty.trigger("EnterFrame",{frame:frame++});nextGameTick+=skipTicks;loops++}if(loops){Crafty.DrawManager.draw()}},getFPS:function(){return this.fps}},e:function(){var id=UID(),craft;entities[id]=null;entities[id]=craft=Crafty(id);if(arguments.length>0){craft.addComponent.apply(craft,arguments)}craft.addComponent("obj");return craft},c:function(id,fn){components[id]=fn},trigger:function(event,data){var hdl=handlers[event],h,i,l;for(h in hdl){if(!hdl.hasOwnProperty(h))continue;for(i=0,l=hdl[h].length;i<l;i++){if(hdl[h]&&hdl[h][i]){if(entities[h]){hdl[h][i].call(Crafty(+h),data)}else{hdl[h][i].call(Crafty,data)}}}}},bind:function(event,callback){if(!handlers[event])handlers[event]={};var hdl=handlers[event];if(!hdl.global)hdl.global=[];return hdl.global.push(callback)-1},unbind:function(event,callback){var hdl=handlers[event],h,i,l;for(h in hdl){if(!hdl.hasOwnProperty(h))continue;if(typeof callback==="number"){delete hdl[h][callback];return true}for(i=0,l=hdl[h].length;i<l;i++){if(hdl[h][i]===callback){delete hdl[h][i];return true}}}return false},frame:function(){return frame},components:function(){return components},debug:function(){return entities},settings:(function(){var states={},callbacks={};return{register:function(setting,callback){callbacks[setting]=callback},modify:function(setting,value){if(!callbacks[setting])return;callbacks[setting].call(states[setting],value);states[setting]=value},get:function(setting){return states[setting]}}})(),clone:clone});function UID(){var id=GUID++;if(id in entities){return UID()}return id}function clone(obj){if(obj===null||typeof(obj)!='object')return obj;var temp=obj.constructor();for(var key in obj)temp[key]=clone(obj[key]);return temp}Crafty.bind("Load",function(){if(!Crafty.support.setter&&Crafty.support.defineProperty){noSetter=[];Crafty.bind("EnterFrame",function(){var i=0,l=noSetter.length,current;for(;i<l;++i){current=noSetter[i];if(current.obj[current.prop]!==current.obj['_'+current.prop]){current.fn.call(current.obj,current.obj[current.prop])}}})}});window.Crafty=Crafty})(window);(function(Crafty,window,document){(function(parent){var cellsize,HashMap=function(cell){cellsize=cell||64;this.map={}},SPACE=" ";HashMap.prototype={insert:function(obj){var keys=HashMap.key(obj),entry=new Entry(keys,obj,this),i=0,j,hash;for(i=keys.x1;i<=keys.x2;i++){for(j=keys.y1;j<=keys.y2;j++){hash=i+SPACE+j;if(!this.map[hash])this.map[hash]=[];this.map[hash].push(obj)}}return entry},search:function(rect,filter){var keys=HashMap.key(rect),i,j,hash,results=[];if(filter===undefined)filter=true;for(i=keys.x1;i<=keys.x2;i++){for(j=keys.y1;j<=keys.y2;j++){hash=i+SPACE+j;if(this.map[hash]){results=results.concat(this.map[hash])}}}if(filter){var obj,id,finalresult=[],found={};for(i=0,l=results.length;i<l;i++){obj=results[i];if(!obj)continue;id=obj[0];if(!found[id]&&obj.x<rect._x+rect._w&&obj._x+obj._w>rect._x&&obj.y<rect._y+rect._h&&obj._h+obj._y>rect._y)found[id]=results[i]}for(obj in found)finalresult.push(found[obj]);return finalresult}else{return results}},remove:function(keys,obj){var i=0,j,hash;if(arguments.length==1){obj=keys;keys=HashMap.key(obj)}for(i=keys.x1;i<=keys.x2;i++){for(j=keys.y1;j<=keys.y2;j++){hash=i+SPACE+j;if(this.map[hash]){var cell=this.map[hash],m=0,n=cell.length;for(;m<n;m++)if(cell[m]&&cell[m][0]===obj[0])cell.splice(m,1)}}}}};HashMap.key=function(obj){if(obj.hasOwnProperty('mbr')){obj=obj.mbr()}var x1=~~(obj._x/cellsize),y1=~~(obj._y/cellsize),x2=~~((obj._w+obj._x)/cellsize),y2=~~((obj._h+obj._y)/cellsize);return{x1:x1,y1:y1,x2:x2,y2:y2}};HashMap.hash=function(keys){return keys.x1+SPACE+keys.y1+SPACE+keys.x2+SPACE+keys.y2};function Entry(keys,obj,map){this.keys=keys;this.map=map;this.obj=obj}Entry.prototype={update:function(rect){if(HashMap.hash(HashMap.key(rect))!=HashMap.hash(this.keys)){this.map.remove(this.keys,this.obj);var e=this.map.insert(this.obj);this.keys=e.keys}}};parent.HashMap=HashMap})(Crafty);Crafty.map=new Crafty.HashMap();var M=Math,Mc=M.cos,Ms=M.sin,PI=M.PI,DEG_TO_RAD=PI/180;Crafty.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_rotation:0,_alpha:1.0,_visible:true,_global:null,_origin:null,_mbr:null,_entry:null,_children:null,_changed:false,init:function(){this._global=this[0];this._origin={x:0,y:0};this._children=[];if(Crafty.support.setter){this.__defineSetter__('x',function(v){this._attr('_x',v)});this.__defineSetter__('y',function(v){this._attr('_y',v)});this.__defineSetter__('w',function(v){this._attr('_w',v)});this.__defineSetter__('h',function(v){this._attr('_h',v)});this.__defineSetter__('z',function(v){this._attr('_z',v)});this.__defineSetter__('rotation',function(v){this._attr('_rotation',v)});this.__defineSetter__('alpha',function(v){this._attr('_alpha',v)});this.__defineSetter__('visible',function(v){this._attr('_visible',v)});this.__defineGetter__('x',function(){return this._x});this.__defineGetter__('y',function(){return this._y});this.__defineGetter__('w',function(){return this._w});this.__defineGetter__('h',function(){return this._h});this.__defineGetter__('z',function(){return this._z});this.__defineGetter__('rotation',function(){return this._rotation});this.__defineGetter__('alpha',function(){return this._alpha});this.__defineGetter__('visible',function(){return this._visible})}else if(Crafty.support.defineProperty){Object.defineProperty(this,'x',{set:function(v){this._attr('_x',v)},get:function(){return this._x}});Object.defineProperty(this,'y',{set:function(v){this._attr('_y',v)},get:function(){return this._y}});Object.defineProperty(this,'w',{set:function(v){this._attr('_w',v)},get:function(){return this._w}});Object.defineProperty(this,'h',{set:function(v){this._attr('_h',v)},get:function(){return this._h}});Object.defineProperty(this,'z',{set:function(v){this._attr('_z',v)},get:function(){return this._z}});Object.defineProperty(this,'rotation',{set:function(v){this._attr('_rotation',v)},get:function(){return this._rotation}});Object.defineProperty(this,'alpha',{set:function(v){this._attr('_alpha',v)},get:function(){return this._alpha}});Object.defineProperty(this,'visible',{set:function(v){this._attr('_visible',v)},get:function(){return this._visible}})}else{this.x=this._x;this.y=this._y;this.w=this._w;this.h=this._h;this.z=this._z;this.rotation=this._rotation;this.alpha=this._alpha;this.visible=this._visible;this.bind("EnterFrame",function(){if(this.x!==this._x||this.y!==this._y||this.w!==this._w||this.h!==this._h||this.z!==this._z||this.rotation!==this._rotation||this.alpha!==this._alpha||this.visible!==this._visible){var old=this.mbr()||this.pos();if(this.rotation!==this._rotation){this._rotate(this.rotation)}else{var mbr=this._mbr,moved=false;if(mbr){if(this.x!==this._x){mbr._x-=this.x-this._x;moved=true}else if(this.y!==this._y){mbr._y-=this.y-this._y;moved=true}else if(this.w!==this._w){mbr._w-=this.w-this._w;moved=true}else if(this.h!==this._h){mbr._h-=this.h-this._h;moved=true}else if(this.z!==this._z){mbr._z-=this.z-this._z;moved=true}}if(moved)this.trigger("Move",old)}this._x=this.x;this._y=this.y;this._w=this.w;this._h=this.h;this._z=this.z;this._rotation=this.rotation;this._alpha=this.alpha;this._visible=this.visible;this.trigger("Change",old)}})}this._entry=Crafty.map.insert(this);this.bind("Move",function(e){var area=this._mbr||this;this._entry.update(area);this._cascade(e)});this.bind("Rotate",function(e){var old=this._mbr||this;this._entry.update(old);this._cascade(e)});this.bind("Remove",function(){Crafty.map.remove(this);this.detach()})},_rotate:function(v){var theta=-1*(v%360),rad=theta*DEG_TO_RAD,ct=Math.cos(rad),st=Math.sin(rad),o={x:this._origin.x+this._x,y:this._origin.y+this._y};if(!theta){this._mbr=null;if(!this._rotation%360)return}var x0=o.x+(this._x-o.x)*ct+(this._y-o.y)*st,y0=o.y-(this._x-o.x)*st+(this._y-o.y)*ct,x1=o.x+(this._x+this._w-o.x)*ct+(this._y-o.y)*st,y1=o.y-(this._x+this._w-o.x)*st+(this._y-o.y)*ct,x2=o.x+(this._x+this._w-o.x)*ct+(this._y+this._h-o.y)*st,y2=o.y-(this._x+this._w-o.x)*st+(this._y+this._h-o.y)*ct,x3=o.x+(this._x-o.x)*ct+(this._y+this._h-o.y)*st,y3=o.y-(this._x-o.x)*st+(this._y+this._h-o.y)*ct,minx=Math.floor(Math.min(x0,x1,x2,x3)),miny=Math.floor(Math.min(y0,y1,y2,y3)),maxx=Math.ceil(Math.max(x0,x1,x2,x3)),maxy=Math.ceil(Math.max(y0,y1,y2,y3));this._mbr={_x:minx,_y:miny,_w:maxx-minx,_h:maxy-miny};var difference=this._rotation-v,drad=difference*DEG_TO_RAD;this.trigger("Rotate",{cos:Math.cos(drad),sin:Math.sin(drad),deg:difference,rad:drad,o:{x:o.x,y:o.y},matrix:{M11:ct,M12:st,M21:-st,M22:ct}})},area:function(){return this._w*this._h},intersect:function(x,y,w,h){var rect,obj=this._mbr||this;if(typeof x==="object"){rect=x}else{rect={x:x,y:y,w:w,h:h}}return obj._x<rect.x+rect.w&&obj._x+obj._w>rect.x&&obj._y<rect.y+rect.h&&obj._h+obj._y>rect.y},within:function(x,y,w,h){var rect;if(typeof x==="object"){rect=x}else{rect={x:x,y:y,w:w,h:h}}return rect.x<=this.x&&rect.x+rect.w>=this.x+this.w&&rect.y<=this.y&&rect.y+rect.h>=this.y+this.h},contains:function(x,y,w,h){var rect;if(typeof x==="object"){rect=x}else{rect={x:x,y:y,w:w,h:h}}return rect.x>=this.x&&rect.x+rect.w<=this.x+this.w&&rect.y>=this.y&&rect.y+rect.h<=this.y+this.h},pos:function(){return{_x:(this._x),_y:(this._y),_w:(this._w),_h:(this._h)}},mbr:function(){if(!this._mbr)return this.pos();return{_x:(this._mbr._x),_y:(this._mbr._y),_w:(this._mbr._w),_h:(this._mbr._h)}},isAt:function(x,y){return this.x<=x&&this.x+this.w>=x&&this.y<=y&&this.y+this.h>=y},move:function(dir,by){if(dir.charAt(0)==='n')this.y-=by;if(dir.charAt(0)==='s')this.y+=by;if(dir==='e'||dir.charAt(1)==='e')this.x+=by;if(dir==='w'||dir.charAt(1)==='w')this.x-=by;return this},shift:function(x,y,w,h){if(x)this.x+=x;if(y)this.y+=y;if(w)this.w+=w;if(h)this.h+=h;return this},_cascade:function(e){if(!e)return;var i=0,children=this._children,l=children.length,obj;if(e.cos){for(;i<l;++i){obj=children[i];if('rotate'in obj)obj.rotate(e)}}else{var rect=this._mbr||this,dx=rect._x-e._x,dy=rect._y-e._y,dw=rect._w-e._w,dh=rect._h-e._h;for(;i<l;++i){obj=children[i];obj.shift(dx,dy,dw,dh)}}},attach:function(){var i=0,arg=arguments,l=arguments.length,obj;for(;i<l;++i){obj=arg[i];this._children.push(obj)}return this},detach:function(obj){if(!obj){this._children=[];return this}for(var i=0;i<this._children.length;i++){if(this._children[i]==obj){this._children.splice(i,1)}}return this},origin:function(x,y){if(typeof x==="string"){if(x==="centre"||x==="center"||x.indexOf(' ')===-1){x=this._w/2;y=this._h/2}else{var cmd=x.split(' ');if(cmd[0]==="top")y=0;else if(cmd[0]==="bottom")y=this._h;else if(cmd[0]==="middle"||cmd[1]==="center"||cmd[1]==="centre")y=this._h/2;if(cmd[1]==="center"||cmd[1]==="centre"||cmd[1]==="middle")x=this._w/2;else if(cmd[1]==="left")x=0;else if(cmd[1]==="right")x=this._w}}else if(x>this._w||y>this._h||x<0||y<0)return this;this._origin.x=x;this._origin.y=y;return this},rotate:function(e){this._origin.x=e.o.x-this._x;this._origin.y=e.o.y-this._y;this._attr('_rotation',e.theta)},_attr:function(name,value){var pos=this.pos(),old=this.mbr()||pos;if(name==='_rotation'){this._rotate(value)}else if(name==='_z'){this._global=parseInt(value+Crafty.zeroFill(this[0],5),10);this.trigger("reorder")}else if(name=='_x'||name==='_y'||name==='_w'||name==='_h'){var mbr=this._mbr;if(mbr){mbr[name]-=this[name]-value}this[name]=value;this.trigger("Move",old)}this[name]=value;this.trigger("Change",old)}});Crafty.c("Physics",{_gravity:0.4,_friction:0.2,_bounce:0.5,gravity:function(gravity){this._gravity=gravity}});Crafty.c("Gravity",{_gravity:0.2,_gy:0,_falling:true,_anti:null,init:function(){if(!this.has("2D"))this.addComponent("2D")},gravity:function(comp){if(comp)this._anti=comp;this.bind("EnterFrame",this._enterframe);return this},_enterframe:function(){if(this._falling){this._gy+=this._gravity*2;this.y+=this._gy}else{this._gy=0}var obj,hit=false,pos=this.pos(),q,i=0,l;pos._y++;pos.x=pos._x;pos.y=pos._y;pos.w=pos._w;pos.h=pos._h;q=Crafty.map.search(pos);l=q.length;for(;i<l;++i){obj=q[i];if(obj!==this&&obj.has(this._anti)&&obj.intersect(pos)){hit=obj;break}}if(hit){if(this._falling)this.stopFalling(hit)}else{this._falling=true}},stopFalling:function(e){if(e)this.y=e._y-this._h;this._falling=false;if(this._up)this._up=false;this.trigger("hit")},antigravity:function(){this.unbind("EnterFrame",this._enterframe)}});Crafty.polygon=function(poly){if(arguments.length>1){poly=Array.prototype.slice.call(arguments,0)}this.points=poly};Crafty.polygon.prototype={containsPoint:function(x,y){var p=this.points,i,j,c=false;for(i=0,j=p.length-1;i<p.length;j=i++){if(((p[i][1]>y)!=(p[j][1]>y))&&(x<(p[j][0]-p[i][0])*(y-p[i][1])/(p[j][1]-p[i][1])+p[i][0])){c=!c}}return c},shift:function(x,y){var i=0,l=this.points.length,current;for(;i<l;i++){current=this.points[i];current[0]+=x;current[1]+=y}},rotate:function(e){var i=0,l=this.points.length,current,x,y;for(;i<l;i++){current=this.points[i];x=e.o.x+(current[0]-e.o.x)*e.cos+(current[1]-e.o.y)*e.sin;y=e.o.y-(current[0]-e.o.x)*e.sin+(current[1]-e.o.y)*e.cos;current[0]=Math.floor(x);current[1]=Math.floor(y)}}};Crafty.c("Collision",{init:function(){this.requires("2D")},collision:function(poly){var area=this._mbr||this;if(!poly){poly=new Crafty.polygon([0,0],[area._w,0],[area._w,area._h],[0,area._h])}this.map=poly;this.attach(this.map);this.map.shift(area._x,area._y);return this},hit:function(comp){var area=this._mbr||this,results=Crafty.map.search(area,false),i=0,l=results.length,dupes={},id,obj,oarea,key,hasMap=('map'in this&&'containsPoint'in this.map),finalresult=[];if(!l){return false}for(;i<l;++i){obj=results[i];oarea=obj._mbr||obj;if(!obj)continue;id=obj[0];if(!dupes[id]&&this[0]!==id&&obj.__c[comp]&&oarea._x<area._x+area._w&&oarea._x+oarea._w>area._x&&oarea._y<area._y+area._h&&oarea._h+oarea._y>area._y)dupes[id]=obj}for(key in dupes){obj=dupes[key];if(hasMap&&'map'in obj){var SAT=this._SAT(this.map,obj.map);SAT.obj=obj;SAT.type="SAT";if(SAT)finalresult.push(SAT)}else{finalresult.push({obj:obj,type:"MBR"})}}if(!finalresult.length){return false}return finalresult},onHit:function(comp,fn,fnOff){var justHit=false;this.bind("EnterFrame",function(){var hitdata=this.hit(comp);if(hitdata){justHit=true;fn.call(this,hitdata)}else if(justHit){if(typeof fnOff=='function'){fnOff.call(this)}justHit=false}});return this},_SAT:function(poly1,poly2){var points1=poly1.points,points2=poly2.points,i=0,l=points1.length,j,k=points2.length,normal={x:0,y:0},length,min1,min2,max1,max2,interval,MTV=null,dot,nextPoint,currentPoint;for(;i<l;i++){nextPoint=points1[(i==l-1?0:i+1)];currentPoint=points1[i];normal.x=-(nextPoint[1]-currentPoint[1]);normal.y=(nextPoint[0]-currentPoint[0]);length=Math.sqrt(normal.x*normal.x+normal.y*normal.y);normal.x/=length;normal.y/=length;min1=min2=-1;max1=max2=-1;for(j=0;j<l;++j){dot=points1[j][0]*normal.x+points1[j][1]*normal.y;if(dot>max1||max1===-1)max1=dot;if(dot<min1||min1===-1)min1=dot}for(j=0;j<k;++j){dot=points2[j][0]*normal.x+points2[j][1]*normal.y;if(dot>max2||max2===-1)max2=dot;if(dot<min2||min2===-1)min2=dot}interval=(min1<min2)?min2-max1:min1-max2;if(interval>0){return false}if(interval>MTV||MTV===null)MTV=interval}for(i=0;i<k;i++){nextPoint=points2[(i==k-1?0:i+1)];currentPoint=points2[i];normal.x=-(nextPoint[1]-currentPoint[1]);normal.y=(nextPoint[0]-currentPoint[0]);length=Math.sqrt(normal.x*normal.x+normal.y*normal.y);normal.x/=length;normal.y/=length;min1=min2=-1;max1=max2=-1;for(j=0;j<l;++j){dot=points1[j][0]*normal.x+points1[j][1]*normal.y;if(dot>max1||max1===-1)max1=dot;if(dot<min1||min1===-1)min1=dot}for(j=0;j<k;++j){dot=points2[j][0]*normal.x+points2[j][1]*normal.y;if(dot>max2||max2===-1)max2=dot;if(dot<min2||min2===-1)min2=dot}interval=(min1<min2)?min2-max1:min1-max2;if(interval>0){return false}if(interval>MTV||MTV===null)MTV=interval}return{overlap:MTV}}});Crafty.c("DOM",{_element:null,init:function(){this._element=document.createElement("div");Crafty.stage.inner.appendChild(this._element);this._element.style.position="absolute";this._element.id="ent"+this[0];this.bind("Change",function(){if(!this._changed){this._changed=true;Crafty.DrawManager.add(this)}});function updateClass(){var i=0,c=this.__c,str="";for(i in c){str+=' '+i}str=str.substr(1);this._element.className=str}this.bind("NewComponent",updateClass).bind("RemoveComponent",updateClass);if(Crafty.support.prefix==="ms"&&Crafty.support.version<9){this._filters={};this.bind("Rotate",function(e){var m=e.matrix,elem=this._element.style,M11=m.M11.toFixed(8),M12=m.M12.toFixed(8),M21=m.M21.toFixed(8),M22=m.M22.toFixed(8);this._filters.rotation="progid:DXImageTransform.Microsoft.Matrix(M11="+M11+", M12="+M12+", M21="+M21+", M22="+M22+", sizingMethod='auto expand')"})}this.bind("Remove",this.undraw)},DOM:function(elem){if(elem&&elem.nodeType){this.undraw();this._element=elem;this._element.style.position='absolute'}return this},draw:function(){var style=this._element.style,coord=this.__coord||[0,0,0,0],co={x:coord[0],y:coord[1]},prefix=Crafty.support.prefix,trans=[];if(!this._visible)style.visibility="hidden";else style.visibility="visible";if(Crafty.support.css3dtransform)trans.push("translate3d("+(~~this._x)+"px,"+(~~this._y)+"px,0)");else trans.push("translate("+(~~this._x)+"px,"+(~~this._y)+"px,0)");style.width=~~(this._w)+"px";style.height=~~(this._h)+"px";style.zIndex=this._z;style.opacity=this._alpha;style[prefix+"Opacity"]=this._alpha;if(prefix==="ms"&&Crafty.support.version<9){if(Crafty.support.version===8){this._filters.alpha="progid:DXImageTransform.Microsoft.Alpha(Opacity="+(this._alpha*100)+")"}else{this._filters.alpha="alpha(opacity="+(this._alpha*100)+")"}this.applyFilters()}if(this._mbr){var origin=this._origin.x+"px "+this._origin.y+"px";style.transformOrigin=origin;style[prefix+"TransformOrigin"]=origin;if(Crafty.support.css3dtransform)trans.push("rotateZ("+this._rotation+"deg)");else trans.push("rotate("+this._rotation+"deg)")}style.transform=trans.join(" ");style[prefix+"Transform"]=trans.join(" ");this.trigger("Draw",{style:style,type:"DOM",co:co});return this},applyFilters:function(){this._element.style.filter="";for(var filter in this._filters){if(!this._filters.hasOwnProperty(filter))continue;this._element.style.filter+=this._filters[filter]+" "}},undraw:function(){Crafty.stage.inner.removeChild(this._element);return this},css:function(obj,value){var key,elem=this._element,val,style=elem.style;if(typeof obj==="object"){for(key in obj){if(!obj.hasOwnProperty(key))continue;val=obj[key];if(typeof val==="number")val+='px';style[Crafty.DOM.camelize(key)]=val}}else{if(value){if(typeof value==="number")value+='px';style[Crafty.DOM.camelize(obj)]=value}else{return Crafty.DOM.getStyle(elem,obj)}}this.trigger("Change");return this}});try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}Crafty.extend({DOM:{window:{init:function(){this.width=window.innerWidth||(window.document.documentElement.clientWidth||window.document.body.clientWidth);this.height=window.innerHeight||(window.document.documentElement.clientHeight||window.document.body.clientHeight)},width:0,height:0},inner:function(obj){var rect=obj.getBoundingClientRect(),x=rect.left+window.pageXOffset,y=rect.top+window.pageYOffset,borderX,borderY;borderX=parseInt(this.getStyle(obj,'border-left-width')||0,10);borderY=parseInt(this.getStyle(obj,'border-top-width')||0,10);if(!borderX||!borderY){borderX=parseInt(this.getStyle(obj,'borderLeftWidth')||0,10);borderY=parseInt(this.getStyle(obj,'borderTopWidth')||0,10)}x+=borderX;y+=borderY;return{x:x,y:y}},getStyle:function(obj,prop){var result;if(obj.currentStyle)result=obj.currentStyle[this.camelize(prop)];else if(window.getComputedStyle)result=document.defaultView.getComputedStyle(obj,null).getPropertyValue(this.csselize(prop));return result},camelize:function(str){return str.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():''})},csselize:function(str){return str.replace(/[A-Z]/g,function(chr){return chr?'-'+chr.toLowerCase():''})},translate:function(x,y){return{x:x-Crafty.stage.x+document.body.scrollLeft+document.documentElement.scrollLeft-Crafty.viewport._x,y:y-Crafty.stage.y+document.body.scrollTop+document.documentElement.scrollTop-Crafty.viewport._y}}}});Crafty.extend({randRange:function(from,to){return Math.round(Math.random()*(to-from)+from)},zeroFill:function(number,width){width-=number.toString().length;if(width>0)return new Array(width+(/\./.test(number)?2:1)).join('0')+number;return number.toString()},sprite:function(tile,tileh,url,map,paddingX,paddingY){var pos,temp,x,y,w,h,img;if(typeof tile==="string"){map=url;url=tileh;tile=1;tileh=1}if(typeof tileh=="string"){map=url;url=tileh;tileh=tile}if(!paddingY&&paddingX)paddingY=paddingX;paddingX=parseInt(paddingX||0,10);paddingY=parseInt(paddingY||0,10);img=Crafty.assets[url];if(!img){img=new Image();img.src=url;Crafty.assets[url]=img;img.onload=function(){for(var pos in map){Crafty(pos).each(function(){this.ready=true;this.trigger("Change")})}}}for(pos in map){if(!map.hasOwnProperty(pos))continue;temp=map[pos];x=temp[0]*tile+paddingX;y=temp[1]*tileh+paddingY;w=temp[2]*tile||tile;h=temp[3]*tileh||tileh;Crafty.c(pos,{__image:url,__coord:[x,y,w,h],__tile:tile,__tileh:tileh,__padding:[paddingX,paddingY],__trim:null,img:img,ready:false,init:function(){this.addComponent("Sprite");this.__trim=[0,0,0,0];this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]];if(this.img.complete&&this.img.width>0){this.ready=true;this.trigger("Change")}this.w=this.__coord[2];this.h=this.__coord[3];var draw=function(e){var co=e.co,pos=e.pos,context=e.ctx;if(e.type==="canvas"){context.drawImage(this.img,co.x,co.y,co.w,co.h,pos._x,pos._y,pos._w,pos._h)}else if(e.type==="DOM"){this._element.style.background="url('"+this.__image+"') no-repeat -"+co.x+"px -"+co.y+"px"}};this.bind("Draw",draw).bind("RemoveComponent",function(id){if(id===pos)this.unbind("Draw",draw)})},sprite:function(x,y,w,h){this.__coord=[x*this.__tile+this.__padding[0]+this.__trim[0],y*this.__tileh+this.__padding[1]+this.__trim[1],this.__trim[2]||w*this.__tile||this.__tile,this.__trim[3]||h*this.__tileh||this.__tileh];this.trigger("Change");return this},crop:function(x,y,w,h){var old=this._mbr||this.pos();this.__trim=[];this.__trim[0]=x;this.__trim[1]=y;this.__trim[2]=w;this.__trim[3]=h;this.__coord[0]+=x;this.__coord[1]+=y;this.__coord[2]=w;this.__coord[3]=h;this._w=w;this._h=h;this.trigger("Change",old);return this}})}return this},_events:{},addEvent:function(ctx,obj,type,fn){if(arguments.length===3){fn=type;type=obj;obj=window.document}var afn=function(e){var e=e||window.event;fn.call(ctx,e)},id=ctx[0]||"";if(!this._events[id+obj+type+fn])this._events[id+obj+type+fn]=afn;else return;if(obj.attachEvent){obj.attachEvent('on'+type,afn)}else{obj.addEventListener(type,afn,false)}},removeEvent:function(ctx,obj,type,fn){if(arguments.length===3){fn=type;type=obj;obj=window.document}var id=ctx[0]||"",afn=this._events[id+obj+type+fn];if(afn){if(obj.detachEvent){obj.detachEvent('on'+type,afn)}else obj.removeEventListener(type,afn,false);delete this._events[id+obj+type+fn]}},background:function(color){Crafty.stage.elem.style.background=color},viewport:{width:0,height:0,_x:0,_y:0,scroll:function(axis,v){v=Math.floor(v);var change=(v-this[axis]),context=Crafty.canvas.context,style=Crafty.stage.inner.style,canvas;this[axis]=v;if(axis=='_x'){if(context)context.translate(change,0)}else{if(context)context.translate(0,change)}if(context)Crafty.DrawManager.drawAll();style[axis=='_x'?"left":"top"]=~~v+"px"},rect:function(){return{_x:-this._x,_y:-this._y,_w:this.width,_h:this.height}},init:function(w,h){Crafty.DOM.window.init();this.width=(!w||Crafty.mobile)?Crafty.DOM.window.width:w;this.height=(!h||Crafty.mobile)?Crafty.DOM.window.height:h;var crstage=document.getElementById("cr-stage");Crafty.stage={x:0,y:0,fullscreen:false,elem:(crstage?crstage:document.createElement("div")),inner:document.createElement("div")};if((!w&&!h)||Crafty.mobile){document.body.style.overflow="hidden";Crafty.stage.fullscreen=true}Crafty.addEvent(this,window,"resize",function(){Crafty.DOM.window.init();var w=Crafty.DOM.window.width,h=Crafty.DOM.window.height,offset;if(Crafty.stage.fullscreen){this.width=w;this.height=h;Crafty.stage.elem.style.width=w+"px";Crafty.stage.elem.style.height=h+"px";if(Crafty._canvas){Crafty._canvas.width=w+"px";Crafty._canvas.height=h+"px";Crafty.DrawManager.drawAll()}}offset=Crafty.DOM.inner(Crafty.stage.elem);Crafty.stage.x=offset.x;Crafty.stage.y=offset.y});Crafty.addEvent(this,window,"blur",function(){if(Crafty.settings.get("autoPause")){Crafty.pause()}});Crafty.addEvent(this,window,"focus",function(){if(Crafty._paused){Crafty.pause()}});Crafty.settings.register("stageSelectable",function(v){Crafty.stage.elem.onselectstart=v?function(){return true}:function(){return false}});Crafty.settings.modify("stageSelectable",false);Crafty.settings.register("stageContextMenu",function(v){Crafty.stage.elem.oncontextmenu=v?function(){return true}:function(){return false}});Crafty.settings.modify("stageContextMenu",false);Crafty.settings.register("autoPause",function(){});Crafty.settings.modify("autoPause",false);if(!crstage){document.body.appendChild(Crafty.stage.elem);Crafty.stage.elem.id="cr-stage"}var elem=Crafty.stage.elem.style,offset;Crafty.stage.elem.appendChild(Crafty.stage.inner);Crafty.stage.inner.style.position="absolute";Crafty.stage.inner.style.zIndex="1";elem.width=this.width+"px";elem.height=this.height+"px";elem.overflow="hidden";if(Crafty.mobile){elem.position="absolute";elem.left="0px";elem.top="0px";var meta=document.createElement("meta"),head=document.getElementsByTagName("HEAD")[0];meta.setAttribute("name","viewport");meta.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no");head.appendChild(meta);meta=document.createElement("meta");meta.setAttribute("name","apple-mobile-web-app-capable");meta.setAttribute("content","yes");head.appendChild(meta);setTimeout(function(){window.scrollTo(0,1)},0);Crafty.addEvent(this,window,"touchmove",function(e){e.preventDefault()});Crafty.stage.x=0;Crafty.stage.y=0}else{elem.position="relative";offset=Crafty.DOM.inner(Crafty.stage.elem);Crafty.stage.x=offset.x;Crafty.stage.y=offset.y}if(Crafty.support.setter){this.__defineSetter__('x',function(v){this.scroll('_x',v)});this.__defineSetter__('y',function(v){this.scroll('_y',v)});this.__defineGetter__('x',function(){return this._x});this.__defineGetter__('y',function(){return this._y})}else if(Crafty.support.defineProperty){Object.defineProperty(this,'x',{set:function(v){this.scroll('_x',v)},get:function(){return this._x}});Object.defineProperty(this,'y',{set:function(v){this.scroll('_y',v)},get:function(){return this._y}})}else{this.x=this._x;this.y=this._y;Crafty.e("viewport")}}},support:{},keys:{'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'0':48,'1':49,'2':50,'3':51,'4':52,'5':53,'6':54,'7':55,'8':56,'9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190}});(function testSupport(){var support=Crafty.support,ua=navigator.userAgent.toLowerCase(),match=/(webkit)[ \/]([\w.]+)/.exec(ua)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(ua)||/(ms)ie ([\w.]+)/.exec(ua)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(ua)||[],mobile=/iPad|iPod|iPhone|Android|webOS/i.exec(ua);if(mobile)Crafty.mobile=mobile[0];support.setter=('__defineSetter__'in this&&'__defineGetter__'in this);support.defineProperty=(function(){if(!'defineProperty'in Object)return false;try{Object.defineProperty({},'x',{})}catch(e){return false};return true})();support.audio=('Audio'in window);support.prefix=(match[1]||match[0]);if(support.prefix==="moz")support.prefix="Moz";if(match[2]){support.versionName=match[2];support.version=+(match[2].split("."))[0]}support.canvas=('getContext'in document.createElement("canvas"));support.css3dtransform=(typeof document.createElement("div").style[support.prefix+"Perspective"]!=="undefined")})();Crafty.c("viewport",{init:function(){this.bind("EnterFrame",function(){if(Crafty.viewport._x!==Crafty.viewport.x){Crafty.viewport.scroll('_x',Crafty.viewport.x)}if(Crafty.viewport._y!==Crafty.viewport.y){Crafty.viewport.scroll('_y',Crafty.viewport.y)}})}});Crafty.c("Canvas",{init:function(){if(!Crafty.canvas.context){Crafty.canvas.init()}Crafty.DrawManager.total2D++;this.bind("Change",function(e){if(this._changed===false){this._changed=Crafty.DrawManager.add(e||this,this)}else{if(e)this._changed=Crafty.DrawManager.add(e,this)}});this.bind("Remove",function(){Crafty.DrawManager.total2D--;Crafty.DrawManager.add(this,this)})},draw:function(ctx,x,y,w,h){if(!this.ready)return;if(arguments.length===4){h=w;w=y;y=x;x=ctx;ctx=Crafty.canvas.context}var pos={_x:(this._x+(x||0)),_y:(this._y+(y||0)),_w:(w||this._w),_h:(h||this._h)},context=ctx||Crafty.canvas.context,coord=this.__coord||[0,0,0,0],co={x:coord[0]+(x||0),y:coord[1]+(y||0),w:w||coord[2],h:h||coord[3]};if(this._mbr){context.save();context.translate(this._origin.x+this._x,this._origin.y+this._y);pos._x=-this._origin.x;pos._y=-this._origin.y;context.rotate((this._rotation%360)*(Math.PI/180))}if(this._alpha<1.0){var globalpha=context.globalAlpha;context.globalAlpha=this._alpha}this.trigger("Draw",{type:"canvas",pos:pos,co:co,ctx:context});if(this._mbr){context.restore()}if(globalpha){context.globalAlpha=globalpha}return this}});Crafty.extend({canvas:{context:null,elem:null,init:function(){if(!Crafty.support.canvas){Crafty.trigger("NoCanvas");Crafty.stop();return}var c;c=document.createElement("canvas");c.width=Crafty.viewport.width;c.height=Crafty.viewport.height;c.style.position='absolute';c.style.left="0px";c.style.top="0px";Crafty.stage.elem.appendChild(c);Crafty.canvas.context=c.getContext('2d');Crafty.canvas._canvas=c}}});Crafty.extend({down:null,over:null,mouseObjs:0,keydown:{},mouseDispatch:function(e){if(!Crafty.mouseObjs)return;if(e.type==="touchstart")e.type="mousedown";else if(e.type==="touchmove")e.type="mousemove";else if(e.type==="touchend")e.type="mouseup";var maxz=-1,closest,q,i=0,l,pos=Crafty.DOM.translate(e.clientX,e.clientY),x,y,dupes={};e.realX=x=pos.x;e.realY=y=pos.y;q=Crafty.map.search({_x:x,_y:y,_w:1,_h:1},false);for(l=q.length;i<l;++i){if(!q[i].__c.Mouse)continue;var current=q[i],flag=false;if(dupes[current[0]])continue;else dupes[current[0]]=true;if(current.map){if(current.map.containsPoint(x,y)){flag=true}}else if(current.isAt(x,y))flag=true;if(flag&&(current._z>=maxz||maxz===-1)){if(current._z===maxz&&current[0]<closest[0]){continue}maxz=current._z;closest=current}}if(closest){if(e.type==="mousedown"){this.down=closest;this.down.trigger("MouseDown",e)}else if(e.type==="mouseup"){closest.trigger("MouseUp",e);if(this.down&&closest===this.down){this.down.trigger("Click",e)}this.down=null}else if(e.type==="mousemove"){if(this.over!==closest){if(this.over){this.over.trigger("MouseOut",e);this.over=null}this.over=closest;closest.trigger("MouseOver",e)}}else closest.trigger(e.type,e)}else{if(e.type==="mousemove"&&this.over){this.over.trigger("MouseOut",e);this.over=null}}},keyboardDispatch:function(e){e.key=e.keyCode||e.which;if(e.type==="keydown"){if(Crafty.keydown[e.key]!==true){Crafty.keydown[e.key]=true;Crafty.trigger("KeyDown",e)}}else if(e.type==="keyup"){delete Crafty.keydown[e.key];Crafty.trigger("KeyUp",e)}if(!(e.metaKey||e.altKey||e.ctrlKey)&&!(e.key==8||e.key>=112&&e.key<=135)){if(e.preventDefault)e.preventDefault();else e.returnValue=false;return false}}});Crafty.bind("Load",function(){Crafty.addEvent(this,"keydown",Crafty.keyboardDispatch);Crafty.addEvent(this,"keyup",Crafty.keyboardDispatch);Crafty.addEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch);Crafty.addEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch);Crafty.addEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch);Crafty.addEvent(this,Crafty.stage.elem,"touchstart",Crafty.mouseDispatch);Crafty.addEvent(this,Crafty.stage.elem,"touchmove",Crafty.mouseDispatch);Crafty.addEvent(this,Crafty.stage.elem,"touchend",Crafty.mouseDispatch)});Crafty.bind("Stop",function(){Crafty.removeEvent(this,"keydown",Crafty.keyboardDispatch);Crafty.removeEvent(this,"keyup",Crafty.keyboardDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"mousedown",Crafty.mouseDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",Crafty.mouseDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",Crafty.mouseDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"touchstart",Crafty.mouseDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"touchmove",Crafty.mouseDispatch);Crafty.removeEvent(this,Crafty.stage.elem,"touchend",Crafty.mouseDispatch)});Crafty.c("Mouse",{init:function(){Crafty.mouseObjs++;this.bind("Remove",function(){Crafty.mouseObjs--})},areaMap:function(poly){if(arguments.length>1){var args=Array.prototype.slice.call(arguments,0);poly=new Crafty.polygon(args)}poly.shift(this._x,this._y);this.map=poly;this.attach(this.map);return this}});Crafty.c("Draggable",{_startX:0,_startY:0,_dragging:false,_ondrag:null,_ondown:null,_onup:null,init:function(){this.requires("Mouse");this._ondrag=function(e){var pos=Crafty.DOM.translate(e.clientX,e.clientY);this.x=pos.x-this._startX;this.y=pos.y-this._startY;this.trigger("Dragging",e)};this._ondown=function(e){this._startX=e.realX-this._x;this._startY=e.realY-this._y;this._dragging=true;Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag);Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup);this.trigger("StartDrag",e)};this._onup=function upper(e){Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag);Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup);this._dragging=false;this.trigger("StopDrag",e)};this.enableDrag()},stopDrag:function(){Crafty.removeEvent(this,Crafty.stage.elem,"mousemove",this._ondrag);Crafty.removeEvent(this,Crafty.stage.elem,"mouseup",this._onup);this._dragging=false;this.trigger("StopDrag");return this},startDrag:function(){if(!this._dragging){this._dragging=true;Crafty.addEvent(this,Crafty.stage.elem,"mousemove",this._ondrag)}},enableDrag:function(){this.bind("MouseDown",this._ondown);Crafty.addEvent(this,Crafty.stage.elem,"mouseup",this._onup);return this},disableDrag:function(){this.unbind("MouseDown",this._ondown);this.stopDrag();return this}});Crafty.c("Keyboard",{isDown:function(key){if(typeof key==="string"){key=Crafty.keys[key]}return!!Crafty.keydown[key]}});Crafty.c("Multiway",{_speed:3,init:function(){this._keyDirection={};this._keys={};this._movement={x:0,y:0}},multiway:function(speed,keys){if(keys){this._speed=speed}else{keys=speed}this._keyDirection=keys;this.speed(this._speed);this.bind("KeyDown",function(e){if(this._keys[e.key]){this._movement.x=Math.round((this._movement.x+this._keys[e.keyCode].x)*1000)/1000;this._movement.y=Math.round((this._movement.y+this._keys[e.keyCode].y)*1000)/1000;this.trigger('NewDirection',this._movement)}}).bind("KeyUp",function(e){if(this._keys[e.key]){this._movement.x=Math.round((this._movement.x-this._keys[e.keyCode].x)*1000)/1000;this._movement.y=Math.round((this._movement.y-this._keys[e.keyCode].y)*1000)/1000;this.trigger('NewDirection',this._movement)}}).bind("EnterFrame",function(){if(this.disableControls)return;if(this._movement.x!==0){this.x+=this._movement.x;this.trigger('Moved',{x:this.x-this._movement.x,y:this.y})}if(this._movement.y!==0){this.y+=this._movement.y;this.trigger('Moved',{x:this.x,y:this.y-this._movement.y})}});return this},speed:function(speed){for(var k in this._keyDirection){var keyCode=Crafty.keys[k]||k;this._keys[keyCode]={x:Math.round(Math.cos(this._keyDirection[k]*(Math.PI/180))*1000*speed)/1000,y:Math.round(Math.sin(this._keyDirection[k]*(Math.PI/180))*1000*speed)/1000}}return this}});Crafty.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(speed){this.multiway(speed,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180});return this}});Crafty.c("Twoway",{_speed:3,_up:false,init:function(){this.requires("Keyboard")},twoway:function(speed,jump){if(speed)this._speed=speed;jump=jump||this._speed*2;this.bind("EnterFrame",function(){if(this.disableControls)return;if(this.isDown("RIGHT_ARROW")||this.isDown("D")){this.x+=this._speed}if(this.isDown("LEFT_ARROW")||this.isDown("A")){this.x-=this._speed}if(this._up){this.y-=jump;this._falling=true}}).bind("keydown",function(){if(this.isDown("UP_ARROW")||this.isDown("W"))this._up=true});return this}});Crafty.c("SpriteAnimation",{_reels:null,_frame:null,_current:null,init:function(){this._reels={}},animate:function(id,fromx,y,tox){var reel,i,tile,duration,tileh;if(arguments.length<4&&typeof fromx==="number"){this._current=id;reel=this._reels[id];duration=fromx;this._frame={reel:reel,frameTime:Math.ceil(duration/reel.length),frame:0,current:0,repeat:0,id:id};if(arguments.length===3&&typeof y==="number"){if(y===-1)this._frame.repeatInfinitly=true;else this._frame.repeat=y}var pos=this._frame.reel[0];this.__coord[0]=pos[0];this.__coord[1]=pos[1];this.bind("EnterFrame",this.drawFrame);return this}if(typeof fromx==="number"){i=fromx;reel=[];tile=this.__tile;tileh=this.__tileh;if(tox>fromx){for(;i<=tox;i++){reel.push([i*tile,y*tileh])}}else{for(;i>=tox;i--){reel.push([i*tile,y*tileh])}}reel.id=id;this._reels[id]=reel}else if(typeof fromx==="object"){this._reels[id]=fromx}return this},drawFrame:function(e){var data=this._frame;if(this._frame.current++===data.frameTime){var pos=data.reel[data.frame++];this.__coord[0]=pos[0];this.__coord[1]=pos[1];this._frame.current=0}if(data.frame===data.reel.length&&this._frame.current===data.frameTime){data.frame=0;if(this._frame.repeatInfinitly===true||this._frame.repeat>0){if(this._frame.repeat)this._frame.repeat--;this._frame.current=0;this._frame.frame=0}else{this.trigger("AnimationEnd",{reel:data.reel});this.stop();return}}this.trigger("Change")},stop:function(){this.unbind("EnterFrame",this.drawFrame);this.unbind("AnimationEnd");this._current=null;this._frame=null;return this},reset:function(){if(!this._frame)return this;var co=this._frame.reel[0];this.__coord[0]=co[0];this.__coord[1]=co[1];this.stop();return this},isPlaying:function(id){if(!id)return!!this._interval;return this._current===id}});Crafty.c("Tween",{tween:function(props,duration){this.each(function(){var prop,old={},step={},startFrame=Crafty.frame(),endFrame=startFrame+duration;for(prop in props){old[prop]=this['_'+prop];step[prop]=(props[prop]-old[prop])/duration}this.bind("EnterFrame",function d(e){if(e.frame>=endFrame){this.unbind("EnterFrame",d);return}for(var prop in props){this[prop]+=step[prop]}})});return this}});Crafty.c("Color",{_color:"",ready:true,init:function(){this.bind("Draw",function(e){if(e.type==="DOM"){e.style.background=this._color;e.style.lineHeight=0}else if(e.type==="canvas"){if(this._color)e.ctx.fillStyle=this._color;e.ctx.fillRect(e.pos._x,e.pos._y,e.pos._w,e.pos._h)}})},color:function(color){this._color=color;this.trigger("Change");return this}});Crafty.c("Tint",{_color:null,_strength:1.0,init:function(){var draw=function d(e){var context=e.ctx||Crafty.canvas.context;context.fillStyle=this._color||"rgb(0,0,0)";context.fillRect(e.pos._x,e.pos._y,e.pos._w,e.pos._h)};this.bind("Draw",draw).bind("RemoveComponent",function(id){if(id==="Tint")this.unbind("Draw",draw)})},tint:function(color,strength){this._strength=strength;this._color=Crafty.toRGB(color,this._strength);this.trigger("Change");return this}});Crafty.c("Image",{_repeat:"repeat",ready:false,init:function(){var draw=function(e){if(e.type==="canvas"){if(!this.ready||!this._pattern)return;var context=e.ctx;context.fillStyle=this._pattern;context.fillRect(this._x,this._y,this._w,this._h)}else if(e.type==="DOM"){if(this.__image)e.style.background="url("+this.__image+") "+this._repeat}};this.bind("Draw",draw).bind("RemoveComponent",function(id){if(id==="Image")this.unbind("Draw",draw)})},image:function(url,repeat){this.__image=url;this._repeat=repeat||"no-repeat";this.img=Crafty.assets[url];if(!this.img){this.img=new Image();Crafty.assets[url]=this.img;this.img.src=url;var self=this;this.img.onload=function(){if(self.has("Canvas"))self._pattern=Crafty.canvas.context.createPattern(self.img,self._repeat);self.ready=true;if(self._repeat==="no-repeat"){self.w=self.img.width;self.h=self.img.height}self.trigger("Change")};return this}else{this.ready=true;if(this.has("Canvas"))this._pattern=Crafty.canvas.context.createPattern(this.img,this._repeat);if(this._repeat==="no-repeat"){this.w=this.img.width;this.h=this.img.height}}this.trigger("Change");return this}});Crafty.extend({_scenes:[],_current:null,scene:function(name,fn){if(arguments.length===1){Crafty("2D").each(function(){if(!this.has("persist"))this.destroy()});this._scenes[name].call(this);this._current=name;return}this._scenes[name]=fn;return},rgbLookup:{},toRGB:function(hex,alpha){var lookup=this.rgbLookup[hex];if(lookup)return lookup;var hex=(hex.charAt(0)==='#')?hex.substr(1):hex,c=[],result;c[0]=parseInt(hex.substr(0,2),16);c[1]=parseInt(hex.substr(2,2),16);c[2]=parseInt(hex.substr(4,2),16);result=alpha===undefined?'rgb('+c.join(',')+')':'rgba('+c.join(',')+','+alpha+')';lookup=result;return result}});Crafty.DrawManager=(function(){var register=[],dom=[];return{total2D:Crafty("2D").length,onScreen:function(rect){return Crafty.viewport._x+rect._x+rect._w>0&&Crafty.viewport._y+rect._y+rect._h>0&&Crafty.viewport._x+rect._x<Crafty.viewport.width&&Crafty.viewport._y+rect._y<Crafty.viewport.height},merge:function(set){do{var newset=[],didMerge=false,i=0,l=set.length,current,next,merger;while(i<l){current=set[i];next=set[i+1];if(i<l-1&&current._x<next._x+next._w&&current._x+current._w>next._x&&current._y<next._y+next._h&&current._h+current._y>next._y){merger={_x:~~Math.min(current._x,next._x),_y:~~Math.min(current._y,next._y),_w:Math.max(current._x,next._x)+Math.max(current._w,next._w),_h:Math.max(current._y,next._y)+Math.max(current._h,next._h)};merger._w=merger._w-merger._x;merger._h=merger._h-merger._y;merger._w=(merger._w==~~merger._w)?merger._w:merger._w+1|0;merger._h=(merger._h==~~merger._h)?merger._h:merger._h+1|0;newset.push(merger);i++;didMerge=true}else newset.push(current);i++}set=newset.length?Crafty.clone(newset):set;if(didMerge)i=0}while(didMerge);return set},add:function add(old,current){if(!current){dom.push(old);return}var rect,before=old._mbr||old,after=current._mbr||current;if(old===current){rect=old.mbr()||old.pos()}else{rect={_x:~~Math.min(before._x,after._x),_y:~~Math.min(before._y,after._y),_w:Math.max(before._w,after._w)+Math.max(before._x,after._x),_h:Math.max(before._h,after._h)+Math.max(before._y,after._y)};rect._w=(rect._w-rect._x);rect._h=(rect._h-rect._y)}if(rect._w===0||rect._h===0||!this.onScreen(rect)){return false}rect._x=~~rect._x;rect._y=~~rect._y;rect._w=(rect._w===~~rect._w)?rect._w:rect._w+1|0;rect._h=(rect._h===~~rect._h)?rect._h:rect._h+1|0;register.push(rect);return true},debug:function(){console.log(register,dom)},drawAll:function(rect){var rect=rect||Crafty.viewport.rect(),q,i=0,l,ctx=Crafty.canvas.context,current;q=Crafty.map.search(rect);l=q.length;ctx.clearRect(rect._x,rect._y,rect._w,rect._h);q.sort(function(a,b){return a._global-b._global});for(;i<l;i++){current=q[i];if(current._visible&&current.__c.Canvas){current.draw();current._changed=false}}},boundingRect:function(set){if(!set||!set.length)return;var newset=[],i=1,l=set.length,current,master=set[0],tmp;master=[master._x,master._y,master._x+master._w,master._y+master._h];while(i<l){current=set[i];tmp=[current._x,current._y,current._x+current._w,current._y+current._h];if(tmp[0]<master[0])master[0]=tmp[0];if(tmp[1]<master[1])master[1]=tmp[1];if(tmp[2]>master[2])master[2]=tmp[2];if(tmp[3]>master[3])master[3]=tmp[3];i++}tmp=master;master={_x:tmp[0],_y:tmp[1],_w:tmp[2]-tmp[0],_h:tmp[3]-tmp[1]};return master},draw:function draw(){if(!register.length&&!dom.length)return;var i=0,l=register.length,k=dom.length,rect,q,j,len,dupes,obj,ent,objs=[],ctx=Crafty.canvas.context;for(;i<k;++i){dom[i].draw()._changed=false}dom.length=i=0;if(!l){return}if(l/this.total2D>0.6){this.drawAll();register.length=0;return}register=this.merge(register);for(;i<l;++i){rect=register[i];if(!rect)continue;q=Crafty.map.search(rect,false);dupes={};for(j=0,len=q.length;j<len;++j){obj=q[j];if(dupes[obj[0]]||!obj._visible||!obj.__c.Canvas)continue;dupes[obj[0]]=true;objs.push({obj:obj,rect:rect})}ctx.clearRect(rect._x,rect._y,rect._w,rect._h)}objs.sort(function(a,b){return a.obj._global-b.obj._global});if(!objs.length){return}for(i=0,l=objs.length;i<l;++i){obj=objs[i];rect=obj.rect;ent=obj.obj;var area=ent._mbr||ent,x=(rect._x-area._x<=0)?0:~~(rect._x-area._x),y=(rect._y-area._y<0)?0:~~(rect._y-area._y),w=~~Math.min(area._w-x,rect._w-(area._x-rect._x),rect._w,area._w),h=~~Math.min(area._h-y,rect._h-(area._y-rect._y),rect._h,area._h);if(h===0||w===0)continue;ctx.save();ctx.beginPath();ctx.moveTo(rect._x,rect._y);ctx.lineTo(rect._x+rect._w,rect._y);ctx.lineTo(rect._x+rect._w,rect._h+rect._y);ctx.lineTo(rect._x,rect._h+rect._y);ctx.lineTo(rect._x,rect._y);ctx.clip();ent.draw();ctx.closePath();ctx.restore();ent._changed=false}register.length=0;merged={}}}})();Crafty.extend({isometric:{_tile:0,_z:0,size:function(tile){this._tile=tile;return this},place:function(x,y,z,obj){var m=x*this._tile+(y&1)*(this._tile/2),n=y*this._tile/4,n=n-z*(this._tile/2);obj.attr({x:m+Crafty.viewport._x,y:n+Crafty.viewport._y}).z+=z;return this}}});Crafty.c("particles",{init:function(){this._Particles=Crafty.clone(this._Particles)},particles:function(options){if(!Crafty.support.canvas||Crafty.deactivateParticles)return this;var c,ctx,relativeX,relativeY,bounding;c=document.createElement("canvas");c.width=Crafty.viewport.width;c.height=Crafty.viewport.height;c.style.position='absolute';Crafty.stage.elem.appendChild(c);ctx=c.getContext('2d');this._Particles.init(options);relativeX=this.x+Crafty.viewport.x;relativeY=this.y+Crafty.viewport.y;this._Particles.position=this._Particles.vectorHelpers.create(relativeX,relativeY);var oldViewport={x:Crafty.viewport.x,y:Crafty.viewport.y};this.bind('EnterFrame',function(){relativeX=this.x+Crafty.viewport.x;relativeY=this.y+Crafty.viewport.y;this._Particles.viewportDelta={x:Crafty.viewport.x-oldViewport.x,y:Crafty.viewport.y-oldViewport.y};oldViewport={x:Crafty.viewport.x,y:Crafty.viewport.y};this._Particles.position=this._Particles.vectorHelpers.create(relativeX,relativeY);if(typeof Crafty.DrawManager.boundingRect=='function'){bounding=Crafty.DrawManager.boundingRect(this._Particles.register);if(bounding)ctx.clearRect(bounding._x,bounding._y,bounding._w,bounding._h)}else{ctx.clearRect(0,0,Crafty.viewport.width,Crafty.viewport.height)}this._Particles.update();this._Particles.render(ctx)});return this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:false,gravity:{x:0,y:0.1},jitter:0,particles:[],active:true,particleCount:0,elapsedFrames:0,emissionRate:0,emitCounter:0,particleIndex:0},init:function(options){this.position=this.vectorHelpers.create(0,0);if(typeof options=='undefined')var options={};for(key in this.presets){if(typeof options[key]!='undefined')this[key]=options[key];else this[key]=this.presets[key]}this.emissionRate=this.maxParticles/this.lifeSpan;this.positionRandom=this.vectorHelpers.create(this.spread,this.spread)},addParticle:function(){if(this.particleCount==this.maxParticles){return false}var particle=new this.particle(this.vectorHelpers);this.initParticle(particle);this.particles[this.particleCount]=particle;this.particleCount++;return true},RANDM1TO1:function(){return Math.random()*2-1},initParticle:function(particle){particle.position.x=this.position.x+this.positionRandom.x*this.RANDM1TO1();particle.position.y=this.position.y+this.positionRandom.y*this.RANDM1TO1();var newAngle=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180);var vector=this.vectorHelpers.create(Math.sin(newAngle),-Math.cos(newAngle));var vectorSpeed=this.speed+this.speedRandom*this.RANDM1TO1();particle.direction=this.vectorHelpers.multiply(vector,vectorSpeed);particle.size=this.size+this.sizeRandom*this.RANDM1TO1();particle.size=particle.size<0?0:~~particle.size;particle.timeToLive=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1();particle.sharpness=this.sharpness+this.sharpnessRandom*this.RANDM1TO1();particle.sharpness=particle.sharpness>100?100:particle.sharpness<0?0:particle.sharpness;particle.sizeSmall=~~((particle.size/200)*particle.sharpness);var start=[this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1()];var end=[this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1()];particle.colour=start;particle.deltaColour[0]=(end[0]-start[0])/particle.timeToLive;particle.deltaColour[1]=(end[1]-start[1])/particle.timeToLive;particle.deltaColour[2]=(end[2]-start[2])/particle.timeToLive;particle.deltaColour[3]=(end[3]-start[3])/particle.timeToLive},update:function(){if(this.active&&this.emissionRate>0){var rate=1/this.emissionRate;this.emitCounter++;while(this.particleCount<this.maxParticles&&this.emitCounter>rate){this.addParticle();this.emitCounter-=rate}this.elapsedFrames++;if(this.duration!=-1&&this.duration<this.elapsedFrames){this.stop()}}this.particleIndex=0;this.register=[];var draw;while(this.particleIndex<this.particleCount){var currentParticle=this.particles[this.particleIndex];if(currentParticle.timeToLive>0){currentParticle.direction=this.vectorHelpers.add(currentParticle.direction,this.gravity);currentParticle.position=this.vectorHelpers.add(currentParticle.position,currentParticle.direction);currentParticle.position=this.vectorHelpers.add(currentParticle.position,this.viewportDelta);if(this.jitter){currentParticle.position.x+=this.jitter*this.RANDM1TO1();currentParticle.position.y+=this.jitter*this.RANDM1TO1()}currentParticle.timeToLive--;var r=currentParticle.colour[0]+=currentParticle.deltaColour[0];var g=currentParticle.colour[1]+=currentParticle.deltaColour[1];var b=currentParticle.colour[2]+=currentParticle.deltaColour[2];var a=currentParticle.colour[3]+=currentParticle.deltaColour[3];draw=[];draw.push("rgba("+(r>255?255:r<0?0:~~r));draw.push(g>255?255:g<0?0:~~g);draw.push(b>255?255:b<0?0:~~b);draw.push((a>1?1:a<0?0:a.toFixed(2))+")");currentParticle.drawColour=draw.join(",");if(!this.fastMode){draw[3]="0)";currentParticle.drawColourEnd=draw.join(",")}this.particleIndex++}else{if(this.particleIndex!=this.particleCount-1){this.particles[this.particleIndex]=this.particles[this.particleCount-1]}this.particleCount--}var rect={};rect._x=~~currentParticle.position.x;rect._y=~~currentParticle.position.y;rect._w=currentParticle.size;rect._h=currentParticle.size;this.register.push(rect)}},stop:function(){this.active=false;this.elapsedFrames=0;this.emitCounter=0},render:function(context){for(var i=0,j=this.particleCount;i<j;i++){var particle=this.particles[i];var size=particle.size;var halfSize=size>>1;if(particle.position.x+size<0||particle.position.y+size<0||particle.position.x-size>Crafty.viewport.width||particle.position.y-size>Crafty.viewport.height){continue}var x=~~particle.position.x;var y=~~particle.position.y;if(this.fastMode){context.fillStyle=particle.drawColour}else{var radgrad=context.createRadialGradient(x+halfSize,y+halfSize,particle.sizeSmall,x+halfSize,y+halfSize,halfSize);radgrad.addColorStop(0,particle.drawColour);radgrad.addColorStop(0.9,particle.drawColourEnd);context.fillStyle=radgrad}context.fillRect(x,y,size,size)}},particle:function(vectorHelpers){this.position=vectorHelpers.create(0,0);this.direction=vectorHelpers.create(0,0);this.size=0;this.sizeSmall=0;this.timeToLive=0;this.colour=[];this.drawColour="";this.deltaColour=[];this.sharpness=0},vectorHelpers:{create:function(x,y){return{"x":x,"y":y}},multiply:function(vector,scaleFactor){vector.x*=scaleFactor;vector.y*=scaleFactor;return vector},add:function(vector1,vector2){vector1.x+=vector2.x;vector1.y+=vector2.y;return vector1}}}});Crafty.extend({audio:{_elems:{},_muted:false,MAX_CHANNELS:5,type:{'mp3':'audio/mpeg;','ogg':'audio/ogg; codecs="vorbis"','wav':'audio/wav; codecs="1"','mp4':'audio/mp4; codecs="mp4a.40.2"'},add:function(id,url){if(!Crafty.support.audio)return this;var elem,key,audio=new Audio(),canplay,i=0,sounds=[];if(arguments.length===1&&typeof id==="object"){for(key in id){if(!id.hasOwnProperty(key))continue;if(typeof id[key]!=="string"){var sources=id[key],i=0,l=sources.length,source;for(;i<l;++i){source=sources[i];ext=source.substr(source.lastIndexOf('.')+1).toLowerCase();canplay=audio.canPlayType(this.type[ext]);if(canplay!==""&&canplay!=="no"){url=source;break}}}else{url=id[key]}for(;i<this.MAX_CHANNELS;i++){audio=new Audio(url);audio.preload="auto";audio.load();sounds.push(audio)}this._elems[key]=sounds;if(!Crafty.assets[url])Crafty.assets[url]=this._elems[key][0]}return this}if(typeof url!=="string"){var i=0,l=url.length,source;for(;i<l;++i){source=url[i];ext=source.substr(source.lastIndexOf('.')+1);canplay=audio.canPlayType(this.type[ext]);if(canplay!==""&&canplay!=="no"){url=source;break}}}for(;i<this.MAX_CHANNELS;i++){audio=new Audio(url);audio.preload="auto";audio.load();sounds.push(audio)}this._elems[id]=sounds;if(!Crafty.assets[url])Crafty.assets[url]=this._elems[id][0];return this},play:function(id,repeat){if(!Crafty.support.audio)return;var sounds=this._elems[id],sound,i=0,l=sounds.length;for(;i<l;i++){sound=sounds[i];if(sound.ended||!sound.currentTime){sound.play();break}else if(i===l-1){sound.currentTime=0;sound.play()}}if(typeof repeat=="number"){var j=0;sounds[i].addEventListener('ended',function(){if(repeat==-1||j<=repeat){this.currentTime=0;j++}},false)}return this},settings:function(id,settings){if(!settings){for(var key in this._elems){this.settings(key,id)}return this}var sounds=this._elems[id],sound,setting,i=0,l=sounds.length;for(var setting in settings){for(;i<l;i++){sound=sounds[i];sound[setting]=settings[setting]}}return this},mute:function(){var sounds,sound,i,l,elem;for(sounds in this._elems){elem=this._elems[sounds];for(i=0,l=elem.length;i<l;++i){sound=elem[i];if(!sound.ended&&sound.currentTime){if(this._muted)sound.pause();else sound.play()}}}this._muted=!this._muted;return this}}});Crafty.bind("Pause",function(){Crafty.audio.mute()});Crafty.bind("Unpause",function(){Crafty.audio.mute()});Crafty.c("Text",{_text:"",init:function(){this.bind("Draw",function(e){if(e.type==="DOM"){var el=this._element,style=el.style;el.innerHTML=this._text}})},text:function(text){if(!text)return this._text;this._text=text;this.trigger("Change");return this}});Crafty.extend({assets:{},load:function(data,oncomplete,onprogress,onerror){var i=0,l=data.length,current,obj,total=l,j=0,ext;for(;i<l;++i){current=data[i];ext=current.substr(current.lastIndexOf('.')+1).toLowerCase();if(Crafty.support.audio&&(ext==="mp3"||ext==="wav"||ext==="ogg"||ext==="mp4")){obj=new Audio(current);if(navigator.userAgent.indexOf('Chrome')!=-1)j++}else if(ext==="jpg"||ext==="jpeg"||ext==="gif"||ext==="png"){obj=new Image();obj.src=current}else{total--;continue}this.assets[current]=obj;obj.onload=function(){++j;if(onprogress){onprogress.call(this,{loaded:j,total:total,percent:(j/total*100)})}if(j===total){if(oncomplete)oncomplete()}};obj.onerror=function(){if(onerror){onerror.call(this,{loaded:j,total:total,percent:(j/total*100)})}else{j++;if(j===total){if(oncomplete)oncomplete()}}}}}})})(Crafty,window,window.document);